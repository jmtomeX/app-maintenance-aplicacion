<!-- th:with crea la variable disableFields -->
<div
	th:with="disableFields=!${editMode} and ${#authorization.expression('hasRole(''ROLE_USER'')')}">

	<form class="form-horizontal" role="form" autocomplete="off"
		th:object="${userForm}"
		th:action="${signup}?@{/signup}:(${editMode} ?@{/editUser} :@{/userForm})"
		method="post">
		<!-- comprueba si está en signup y pide el método signup si no verifica si está en modo editar o no-->

		<input class="form-control" type=hidden name="password" value="xxxxx"
			th:if="${editMode}">

		<!--Es necesario para poder pasar la validacion del Model ya que no pueden estar en blanco y se ocultan al editar
	<input class="form-control" type=hidden
		name="confirmPassword" value="xxxxx" th:if="${editMode}"> -->

		<input class="form-control" type=hidden th:field="${userForm.id}"
			th:if="${editMode}">

		<div class="card-body light col-md-12">
			<div class="row g-3 align-items-center my-4">
				<div class="col-sm-2">
					<label for="name" class="col-form-label">Nombre</label>
				</div>
				<div class="col-sm-10">
					<input id="name" class="form-control" type="text"
						th:field="${userForm.firstName}" aria-describedby="nameHelpInline"
						th:disabled="${disableFields}">
					<!--disableFields se crea arriba con la condición del primer div -->
				</div>

				<div id="nameHelpInline" th:if="${#fields.hasErrors('firstName')}"
					th:errors="*{firstName}" class="col-auto alert-danger my-2">Name
					Error</div>
			</div>


			<div class="row g-3 align-items-center my-2">
				<div class="col-sm-2">
					<label class="col-form-label">Apellidos</label>
				</div>
				<div class="col-sm-10">
					<input class="form-control" type="text"
						th:field="${userForm.lastName}" th:disabled="${disableFields}">
				</div>
				<div class="col-auto alert-danger my-2"
					th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}">Name
					Error</div>
			</div>

			<div class="row g-3 align-items-center my-2">
				<div class="col-sm-2">
					<label class="col-form-label">Email</label>
				</div>
				<div class="col-sm-10">
					<input class="form-control" type="email"
						th:field="${userForm.email}" th:disabled="${disableFields}">
				</div>
				<div class="col-auto alert-danger my-2"
					th:if="${#fields.hasErrors('email')}" th:errors="*{email}">Name
					Error</div>
			</div>


			<div class="row g-3 align-items-center my-2">
				<div class="col-sm-2">
					<label class="col-form-label">Usuario</label>
				</div>
				<div class="col-sm-10">
					<input class="form-control" type="text"
						th:field="${userForm.username}" th:disabled="${disableFields}">
				</div>
				<div class="col-auto alert-danger my-2"
					th:if="${#fields.hasErrors('username')}" th:errors="*{username}">Name
					Error</div>
			</div>

			<div class="row g-3 align-items-center my-2">
				<div class="col-sm-2">
					<label class="col-form-label">Roles</label>
				</div>
				<div class="col-sm-6">
					<select class="form-control" size="1" th:field="${userForm.roles}"
					th:disabled="${disableFields}"
						>
						<option th:each="role :${roles}" th:value="${role.id}"
							th:text="${role.name}"></option>
					</select>
				</div>
				<div class="col-auto alert-danger my-2"
					th:if="${#fields.hasErrors('roles')}" th:errors="*{roles}">Name
					Error</div>
				<div class="col-sm-3"></div>
			</div>

			<div class="row g-3 align-items-center my-2"
				th:if="${editMode==null or editMode==false}">
				<div class="col-sm-2">
					<label class="col-form-label">Password</label>
				</div>
				<div class="col-sm-4">
					<input class="form-control" type="password"
						th:field="${userForm.password}" name="confirmPassword"
						th:disabled="${disableFields}">
				</div>
				<div class="col-auto alert-danger my-2"
					th:if="${#fields.hasErrors('password')}" th:errors="*{password}">Name
					Error</div>
				<div class="col-sm-2">
					<label class="col-form-label">Confirmar Password</label>
				</div>
				<div class="col-sm-4">
					<input class="form-control" type="password"
						th:field="${userForm.confirmPassword}" name="confirmPassword"
						th:disabled="${disableFields}">
				</div>
				<div class="col-auto alert-danger my-2"
					th:if="${#fields.hasErrors('confirmPassword')}"
					th:errors="*{confirmPassword}">Name Error</div>
			</div>

			<div class="form-group">
				<div class="text-center">
					<a th:href="@{'/userForm/cancel'}" class="btn btn-secondary my-3">Cancelar</a>
					<!-- data-target hace referencia al modal -->
					<button type="button" class="btn btn-secondary" data-toggle="modal"
						th:if="${editMode}" data-target="#changePasswordModal">Cambiar
						Password</button>

					<!-- <input type="submit" class="btn btn-primary my-3"
						value="Guardar cambios"
						th:value="${editMode} ? 'Modificar usuario':'Crear usuario'" th:disabled="${disableFields}"> -->

					<input type="submit" class="btn btn-primary my-3"
						value="Guardar cambios"
						th:value="${editMode} ? 'Modificar usuario':'Crear usuario'"
						th:if="${!disableFields}">

				</div>
			</div>
		</div>
		<div class="alert alert-danger text-center"
			th:if="${formErrorMessage}" th:text="${formErrorMessage}">Error
			MEssage</div>
		<div class="alert alert-success text-center d-none" id="formSuccess"
			th:if="${editMode}">Success Message</div>
	</form>

</div>